<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        :root {
            /* Colors */
            --white: #FCFCFC;
            --dash: 131313;

            --blue-light-4: #F4F6F9;
            --blue-light-3: #C7D1E7;
            --blue-light-2: #ADB9D4;
            --blue: #6779A6;

            --grey-light-5: #F6F6F6;
            --grey-light-4: #EDEDED;
            --grey-light-3: #BCBCBC;
            --grey-light-2: #B1B1B1;
            --grey: #767676;

            --input-grey: #F7F7F7;
            --button-hover-grey: #F0F0F0;

            /* Linear gradients */
            --body-background: linear-gradient(72.25deg, #E8E8EA, #6073A3);

            /* Borders colors */


            /* Texts color */
            --text-grey-light: #C6C6C6;
            --text-grey: #767676;
            --title-grey: #B7B7B7;

            --transparent-white: rgba(250, 250, 205, .1); /* Only for Poulpidou title */


            /* Texts size */
        }

        body {
            font-family: Inter, sans-serif;
            font-size: 14px;
            font-style: normal;
            color: var(--dash);
        }

        h1 {
            color: var(--blue);
            font-size: 22px;
            margin-top: 50px !important;
            margin-bottom: 50px !important;
            font-weight: bold;
            display: block;
        }

        .flex-row {
            display: flex;
            flex-direction: row;
        }

        .flex-row-center {
            display: flex;
            flex-direction: row;
            justify-content: center;
        }

        .flex-row-around {
            display: flex;
            flex-direction: row;
            justify-content: space-around;
        }

        .align-start {
            align-items: start;
        }

        .align-center {
            align-items: center;
        }

        .align-end {
            align-items: end;
        }

        .flex-row-start {
            display: flex;
            flex-direction: row;
            justify-content: start;
        }

        .w-40 {
            width: 40%;
        }

        .flex-row-between {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

        .flex-row-evenly {
            display: flex;
            flex-direction: row;
            justify-content: space-evenly;
        }

        .flex-row-wrap {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: start;
        }

        .flex-col {
            display: flex;
            flex-direction: column;
        }

        .flex-col-center {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .flex-col-around {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
        }

        .flex-col-between {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .flex-col-start {
            display: flex;
            flex-direction: column;
            justify-content: start;
        }

        .flex-col-end {
            display: flex;
            flex-direction: column;
            justify-content: end;
        }

        .flex-col-evenly {
            display: flex;
            flex-direction: column;
            justify-content: space-evenly;
        }

        .grid-center {
            display: grid;
            justify-content: center;
            align-items: center;
        }

        .horizontal-line {
            width: 100%;
            height: 4px;
            margin: 10px 0;

            background-color: var(--grey-light-4);

            border-radius: 2px;

            display: block;
        }

        .vertical-line {
            width: 4px;
            margin-top: 10px;
            margin-right: 10px;

            background-color: var(--blue);

            border-radius: 2px;

            display: block;
        }

        .name {
            font-weight: bold;
            font-size: 16px;

        }

        /*   HEADER    */
        .workerSection {
            padding-bottom: 20px;
        }

        .workerContainer {
            margin-left: 1cm;

        }

        .headerMontantTotal {
            position: absolute;
            top: 0px;
            right: 0px;
        }

        /*   CLIENT SECTION    */
        .clientSection {
            padding-top: 20px;
            padding-bottom: 20px;

        }

        /*   TABLE    */
        table {
            color: var(--dash);
            font-weight: normal !important;

            width: 100%;
            text-align: left !important;

            border: 1px solid #d9d9d9;
        }

        thead, tfoot {
            background: var(--blue-light-4);
        }

        td, th {
            border: 0;
            padding: 10px;
            vertical-align: top;
        }


        thead, tfoot, tbody {
            width: 100%;
        }

        .no-wrap {
            white-space: nowrap;
        }

        .endText {
            text-align: end;
        }

        .centerText {
            text-align: center;
        }

        .detailTitle {
            font-weight: bold;
        }

        .page-break {
            page-break-before: always;
            border: 2px solid red;
            width: 100%;
        }
    </style>
</head>
<body>
{% set total = 0 %}
{% for detail in details %}
    {% set total = total + detail.price %}
{% endfor %}
<div class="flex-row align-start workerSection">
    <img class="logo" src="{{ absolute_url(asset('pictures/logo.png')) }}" alt="Logo">

    <div class="workerContainer flex-col flex-col-start">
        <span class="name">{{ workerName }}</span>
        <span>meydetour@gmail.com</span>
        <span>   {{ workerPhone is not null ?  workerPhone :  '' }}</span>
        <span>   {{ workerAddress is not null ?  workerAddress :  '' }}</span>
        <span> {{ workerSiret is not null ? 'siret : ' ~ workerSiret :  '' }}</span>
        <span> {{ workerNaf is not null ? 'Code NAF : ' ~ workerNaf :  '' }}</span>
        <span> {{ workerTVA is not null ? 'Numéro de TVA intracommunautaire : ' ~ workerTVA :  '' }}</span>
<span class="aaa"></span>
    </div>
    <div class="flex-col align-end headerMontantTotal">
        <span class="name">Montant Total</span>
        <span>{{ total|number_format(2, ',', ' ') }}€</span>
    </div>

</div>
<hr>
<div class="flex-row-start clientSection">
    <div class="flex-col w-40">
        <span class="name">{{ workerName }}</span>

        <span>   {{ clientEmail is not null ?  clientEmail :  '' }}</span>
        <span>   {{ workerPhone is not null ?  workerPhone :  '' }}</span>
        <span>   {{ clientAddress is not null ?  clientAddress :  '' }}</span>
    </div>
    <div class="flex-col w-40">
        <span> {{ clientSiret is not null ? 'siret : ' ~ clientSiret :  '' }}</span>
        <span> {{ clientNaf is not null ? 'Code NAF : ' ~ clientNaf :  '' }}</span>
        <span> {{ clientTVA is not null ? 'Numéro de TVA intracommunautaire : ' ~ clientTVA :  '' }}</span>


    </div>
</div>
<hr>
<div class="flex-col align-center">
    <h1>Facture n°{{ invoiceNumber }} du {{ invoiceDate }} : Projet {{ projectName }}</h1>
    <table>
        <thead>
        <tr>
            <th scope="col">Description</th>
            <th class="centerText no-wrap" scope="col">Quantité</th>
            <th class="centerText no-wrap" scope="col">Prix unitaire HT</th>
            <th class="endText no-wrap" scope="col">Total HT</th>
        </tr>
        </thead>
        <tbody>

        {% for detail in details %}
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>
                <span class="detailTitle">{{ detail.title }}</span>
                {% if  detail.compositions is not empty %}
                    <ul>
                        {% for compo in detail.compositions %}
                            <li>{{ compo }}</li>
                        {% endfor %}

                    </ul>
                {% endif %}

            </td>
            <td class="centerText">{{ detail.quantity }}</td>
            <td class="centerText">{{ detail.price|number_format(2, ',', ' ') }}€</td>
            <td class="endText">{{ detail.price|number_format(2, ',', ' ') }}€</td>
        </tr>
      {#  <script>
            let debug =   document.querySelector('.aaa')
            debug.textContent = document.querySelector('body').scrollHeight

        </script>
        {% if loop.index is divisible by(5) %}
        </tbody>
    </table>
    <div class="page-break"></div>
    <table>
        <tbody>
        {% endif %}#}
        {% endfor %}

        </tbody>
        <tfoot>
        <tr>
            <td>Sous-total</td>
            <td></td>
            <td></td>
            <td class="endText">{{ total|number_format(2, ',', ' ') }}€</td>
        </tr>

        {% set tva = total * 0.20 %}
        <tr>
            <td>TVA 20%</td>
            <td></td>
            <td></td>
            <td class="endText">{{ tva|number_format(2, ',', ' ') }}€</td>
        </tr>

        {% set total_ttc = total + tva %}
        <tr>
            <td>Total TTC</td>
            <td></td>
            <td></td>
            <td class="endText">{{ total_ttc|number_format(2, ',', ' ') }}€</td>
        </tr>
        </tfoot>
    </table>

</div>

</body>
</html>